{% extends 'admin_base.html' %}

{% block content %}
<h2>All Appointments (Including WhatsApp)</h2>
<p>
  <a class="btn" href="{{ url_for('export_excel') }}">📁 Export Appointments to Excel</a>
</p>
<ul class="card-list">
  {% for appointment, user in appointments %}
    <li class="card">
      <strong>📅 {{ appointment.date }} at {{ appointment.time }}</strong><br>
      <strong>👤 User:</strong> {{ user.username }}<br>
      <strong>📞 Phone:</strong> {{ user.phone or 'N/A' }}<br>
      <strong>📧 Email:</strong> {{ user.email or 'N/A' }}<br>
      <strong>🛁 Bath Type:</strong> {{ appointment.bath_type }} - ₹{{ appointment.price }}<br>
      <strong>📝 Reason:</strong> {{ appointment.reason }}<br>
      <a href="{{ url_for('admin_delete', id=appointment.id) }}" class="btn" onclick="return confirm('Are you sure you want to delete this appointment?')">🗑 Delete</a>
    </li>
  {% else %}
    <li class="card">No appointments found.</li>
  {% endfor %}
</ul>

<hr>
<h2>📊 Admin Analytics</h2>

<h3>🗓 Bookings per Day</h3>
<ul>
  {% for date, count in bookings_per_day %}
    <li><strong>{{ date }}</strong>: {{ count }} bookings</li>
  {% endfor %}
</ul>

<h3>🔥 Most Popular Bath Types</h3>
<ul>
  {% for bath_type, count in top_bath_types %}
    <li><strong>{{ bath_type }}</strong>: {{ count }} bookings</li>
  {% endfor %}
</ul>

{% endblock %}


