{% extends 'admin_base.html' %}

{% block content %}
<h2>All Appointments (Including WhatsApp)</h2>
<p>
  <a class="btn" href="{{ url_for('export_excel') }}">ğŸ“ Export Appointments to Excel</a>
</p>
<ul class="card-list">
  {% for appointment, user in appointments %}
    <li class="card">
      <strong>ğŸ“… {{ appointment.date }} at {{ appointment.time|format_12hr}}</strong><br>
      <strong>ğŸ‘¤ User:</strong> {{ user.username }}<br>
      <strong>ğŸ“ Phone:</strong> {{ user.phone or 'N/A' }}<br>
      <strong>ğŸ“§ Email:</strong> {{ user.email or 'N/A' }}<br>
      <strong>ğŸ› Bath Type:</strong> {{ appointment.bath_type }} - â‚¹{{ appointment.price }}<br>
      <strong>ğŸ“ Reason:</strong> {{ appointment.reason }}<br>

      {% set left = 2 - (appointment.reschedule_count or 0) %}
      <strong>ğŸ” Reschedules Left:</strong> 
      <span {% if left == 0 %}style="color: red;"{% endif %}>{{ left }}</span><br>

      {% if left == 0 %}
        <div style="color: red;"><strong>âŒ No reschedules left!</strong></div>
      {% endif %}

      <a href="{{ url_for('admin_add_reschedule', appointment_id=appointment.id) }}" class="btn">â• Add Reschedule</a><br><br>

      <a href="{{ url_for('admin_delete', id=appointment.id) }}" class="btn" onclick="return confirm('Are you sure you want to delete this appointment?')">ğŸ—‘ Delete</a>
    </li>
  {% else %}
    <li class="card">No appointments found.</li>
  {% endfor %}
</ul>


<hr>
<h2>ğŸ“Š Admin Analytics</h2>

<h3>ğŸ—“ Bookings per Day</h3>
<ul>
  {% for date, count in bookings_per_day %}
    <li><strong>{{ date }}</strong>: {{ count }} bookings</li>
  {% endfor %}
</ul>

<h3>ğŸ”¥ Most Popular Bath Types</h3>
<ul>
  {% for bath_type, count in top_bath_types %}
    <li><strong>{{ bath_type }}</strong>: {{ count }} bookings</li>
  {% endfor %}
</ul>

{% endblock %}


